expeditor:
  secrets:
    PIPELINE_HAB_AUTH_TOKEN:
      path: account/static/habitat/chef-ci
      field: auth_token # Production Builder
    GITHUB_TOKEN:
      account: github/habitat-sh
      field: token
  accounts:
    - aws/habitat # for uploading the bootstrap bundle
  defaults:
    buildkite:
      timeout_in_minutes: 30
      env:
        HAB_ORIGIN: "habitat"
        HAB_BLDR_CHANNEL: "unstable"
        PIPELINE_HAB_BLDR_URL: "https://bldr.habitat.sh"
        GITHUB_USER: "habitat-sh" # per https://github.com/github/hub/issues/2264#issuecomment-567241335

steps:
#######################################################################
# End to end test
#######################################################################
  - label: ":linux: Builder End to End"
    command:
      - .expeditor/scripts/end_to_end/builder_worker_test.sh unstable
    expeditor:
      account:
        - github
      executor:
        docker:
          environment:
            - GITHUB_USER
    soft_fail: true

